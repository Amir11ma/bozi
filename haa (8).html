<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯ÙˆØ² Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ÛŒ</title>
<style>
body { font-family: Tahoma,sans-serif; margin:0; padding:0; background: linear-gradient(135deg,#a1c4fd,#c2e9fb); display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container { display:none; flex-direction:column; justify-content:center; align-items:center; width:100%; padding:20px; }
h1 { color:#fff; text-shadow:0 2px 5px rgba(0,0,0,0.3); margin-bottom:20px; text-align:center; }
input { padding:10px; font-size:18px; border-radius:10px; border:2px solid #2196F3; margin-bottom:20px; width:80%; max-width:300px; }
button { margin:10px; padding:15px 25px; font-size:18px; border:none; border-radius:15px; background:#2196F3; color:#fff; width:80%; max-width:300px; transition:0.3s; cursor:pointer; }
button:hover { background:#1976D2; transform: scale(1.05); }
#board { display:grid; grid-template-columns:repeat(3,100px); grid-gap:10px; margin:20px auto; }
.cell { width:100px; height:100px; font-size:50px; display:flex; justify-content:center; align-items:center; background:#fff; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.3); cursor:pointer; transition:0.3s; }
.cell:hover { transform: scale(1.1) rotate(3deg); background:#e0f7fa; }
#turnMsg { font-size:20px; margin:10px; color:#fff; font-weight:bold; text-align:center; }
#result { font-size:28px; margin:20px; color:#4caf50; animation: glow 1s infinite alternate; text-align:center; }
@keyframes glow { from {text-shadow:0 0 5px #00ff00;} to {text-shadow:0 0 20px #00ff00;} }
#waitingMsg { font-size:18px; color:#fff; animation: pulse 1.5s infinite; text-align:center; }
@keyframes pulse { 0% {opacity:0.5;} 50% {opacity:1;} 100% {opacity:0.5;} }
.leaderboard { background:rgba(255,255,255,0.9); border-radius:15px; padding:20px; margin:20px; width:80%; max-width:400px; box-shadow:0 5px 15px rgba(0,0,0,0.3); }
.leaderboard h2 { color:#2196F3; text-align:center; margin-bottom:15px; }
.leaderboard-item { display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; }
.leaderboard-item:last-child { border-bottom:none; }
.player-name { font-weight:bold; color:#333; }
.player-score { color:#4caf50; font-weight:bold; }
.mode-buttons { display:flex; flex-direction:column; align-items:center; width:100%; }
.mode-title { color:#fff; font-size:24px; margin:20px 0 10px; text-shadow:0 2px 5px rgba(0,0,0,0.3); }
.online-info { background:rgba(255,255,255,0.9); padding:15px; border-radius:10px; margin:10px; text-align:center; }
</style>
</head>
<body>

<!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø§Ø³Ù… -->
<div id="lobby" class="container" style="display:flex;">
<h1>Ø¯ÙˆØ² Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ÛŒ</h1>
<input type="text" id="playerName" placeholder="Ø§Ø³Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" onkeypress="handleEnterKey(event)">
<button onclick="showGameOptions()">Ø§Ø¯Ø§Ù…Ù‡</button>
</div>

<!-- ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù…Ù†Ùˆ -->
<div id="mainMenu" class="container">
<h1>Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ² Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h1>
<div class="mode-buttons">
    <div class="mode-title">Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</div>
    <button onclick="showGameOptions()">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯</button>
    <button onclick="showLeaderboard()">Ø¬Ø¯ÙˆÙ„ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§</button>
</div>
</div>

<!-- ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø¨Ø§Ø²ÛŒ -->
<div id="gameOptions" class="container">
<h1>Ù†ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</h1>
<div class="mode-buttons">
    <button onclick="startSinglePlayer()">Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø±Ø¨Ø§Øª</button>
    <button onclick="startTwoPlayers()">Ø¯Ùˆ Ù†ÙØ±Ù‡ Ø±ÙˆÛŒ ÛŒÚ© Ú¯ÙˆØ´ÛŒ</button>
    <button onclick="startOnline()">Ø­Ø±ÛŒÙ Ø´Ø§Ù†Ø³ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</button>
</div>
</div>

<!-- ØµÙØ­Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ù†Ù„Ø§ÛŒÙ† -->
<div id="onlineInfo" class="container">
<h1>Ø­Ø±ÛŒÙ Ø´Ø§Ù†Ø³ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</h1>
<div class="online-info">
    <p><strong>âš ï¸ ØªÙˆØ¬Ù‡:</strong> Ø§ÛŒÙ† Ø­Ø§Ù„Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¯Ø§Ø±Ø¯</p>
    <p>Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Firebase ÛŒØ§ Ø³Ø±ÙˆØ± backend Ø±Ø§Ù‡ Ø§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ù†ÛŒØ¯</p>
</div>
<div class="mode-buttons">
    <button onclick="startOnlineDemo()">Ø¯Ù…Ùˆ Ø¨Ø§ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…Ø¬Ø§Ø²ÛŒ</button>
    <button onclick="showGameOptions()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- ØµÙØ­Ù‡ Ø§Ù†ØªØ¸Ø§Ø± Ø­Ø±ÛŒÙ Ø¢Ù†Ù„Ø§ÛŒÙ† -->
<div id="waiting" class="container">
<h1>Ø¯Ø± Ø­Ø§Ù„ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø­Ø±ÛŒÙ...</h1>
<p id="waitingMsg">ØµØ¨Ø± Ú©Ù†ÛŒØ¯ ØªØ§ Ø­Ø±ÛŒÙ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´ÙˆØ¯</p>
<button onclick="cancelOnline()">Ù„ØºÙˆ</button>
</div>

<!-- ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† -->
<div id="onlineGame" class="container">
<h1>Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† - Ø­Ø±ÛŒÙ: <span id="opponentName">...</span></h1>
<div id="onlineTurnMsg"></div>
<div id="boardOnline"></div>
</div>

<!-- ØµÙØ­Ù‡ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ -->
<div id="leaderboard" class="container">
<h1>Ø¬Ø¯ÙˆÙ„ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§</h1>
<div class="leaderboard">
    <h2>Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø±Ø¨Ø§Øª</h2>
    <div id="singleLeaderboard"></div>
</div>
<div class="leaderboard">
    <h2>Ø¨Ø§Ø²ÛŒ Ø¯Ùˆ Ù†ÙØ±Ù‡</h2>
    <div id="twoPlayerLeaderboard"></div>
</div>
<div class="leaderboard">
    <h2>Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
    <div id="onlineLeaderboard"></div>
</div>
<button onclick="showMainMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
</div>

<!-- ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ -->
<div id="game" class="container">
<h1>ØªØ®ØªÙ‡ Ø¯ÙˆØ²</h1>
<div id="turnMsg"></div>
<div id="board"></div>
</div>

<!-- ØµÙØ­Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ -->
<div id="gameOver" class="container">
<h1 id="result"></h1>
<button onclick="showMainMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
</div>

<script>
// ====== Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ ======
let player = {name:"", symbol:"", id:""};
let opponent = {name:"", symbol:""};
let board = ["","","","","","","","",""];
let onlineBoard = ["","","","","","","","",""];
let myTurn = false;
let gameId = "";
let gameMode = "";
let currentSymbol = "X";

// ====== Ø¬Ø¯ÙˆÙ„ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ ======
let leaderboards = {
    single: JSON.parse(localStorage.getItem('singleLeaderboard')) || [],
    twoPlayer: JSON.parse(localStorage.getItem('twoPlayerLeaderboard')) || [],
    online: JSON.parse(localStorage.getItem('onlineLeaderboard')) || []
};

// ====== Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† ======
let onlinePlayers = [
    "Ø¹Ù„ÛŒ", "Ù…Ø­Ù…Ø¯", "Ø³Ø§Ø±Ø§", "Ø²Ù‡Ø±Ø§", "Ø§Ù…ÛŒØ±", "Ù¾Ø§Ø±Ø³Ø§", "Ù†Ø§Ø²Ù†ÛŒÙ†", "Ú©Ø§Ù…ÛŒØ§Ø±"
];

// ====== ØªÙˆØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª ======
function showPage(id){ 
    document.querySelectorAll('.container').forEach(c=>c.style.display='none'); 
    document.getElementById(id).style.display='flex'; 
}

function handleEnterKey(event) {
    if (event.key === 'Enter') {
        showGameOptions();
    }
}

function showGameOptions(){ 
    const name = document.getElementById('playerName').value.trim();
    if(!name) {
        alert("Ø§Ø³Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        return;
    }
    player.name = name;
    localStorage.setItem('playerName', name);
    showPage('gameOptions');
}

function showMainMenu() {
    showPage('mainMenu');
}

function showLeaderboard() {
    updateLeaderboardDisplay();
    showPage('leaderboard');
}

// ====== Ø³Ø§Ø®Øª ØªØ®ØªÙ‡ ======
function createBoard(){ 
    const boardDiv = document.getElementById('board'); 
    boardDiv.innerHTML="";
    for(let i=0;i<9;i++){ 
        const cell = document.createElement('div'); 
        cell.className="cell"; 
        cell.id=i; 
        cell.addEventListener('click',()=>cellClick(i)); 
        boardDiv.appendChild(cell); 
    } 
}

function createOnlineBoard(){ 
    const boardDiv = document.getElementById('boardOnline'); 
    boardDiv.innerHTML="";
    for(let i=0;i<9;i++){ 
        const cell = document.createElement('div'); 
        cell.className="cell"; 
        cell.id='online_' + i; 
        cell.addEventListener('click',()=>onlineCellClick(i)); 
        boardDiv.appendChild(cell); 
    } 
}

function updateBoard(){ 
    board.forEach((v,i)=>{ 
        const cell=document.getElementById(i); 
        if(cell) {
            cell.textContent=v; 
            if(v) cell.style.transform="scale(1.2)"; 
            else cell.style.transform="scale(1)";
        }
    });
}

function updateOnlineBoard(){ 
    onlineBoard.forEach((v,i)=>{ 
        const cell=document.getElementById('online_' + i); 
        if(cell) {
            cell.textContent=v; 
            if(v) cell.style.transform="scale(1.2)"; 
            else cell.style.transform="scale(1)";
        }
    });
}

// ====== Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ù†Ø¯Ù‡ ======
function checkWinner(boardState){
    const winComb=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    let winner=null;
    for(let c of winComb){ 
        if(boardState[c[0]] && boardState[c[0]]===boardState[c[1]] && boardState[c[0]]===boardState[c[2]]) 
            winner=boardState[c[0]]; 
    }
    if(!winner && !boardState.includes("")) winner="draw";
    return winner;
}

// ====== Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù…ØªÛŒØ§Ø²Ø§Øª ======
function handleWinner(winner, mode){
    let resultText = "";
    
    if(winner!=="draw"){
        if(mode === "single") {
            if(winner === player.symbol) {
                resultText = "Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯! ğŸ‰";
                updateLeaderboard('single', player.name, 1);
            } else {
                resultText = "Ø±Ø¨Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯! ğŸ¤–";
            }
        } else if(mode === "two") {
            resultText = `Ø¨Ø§Ø²ÛŒÚ©Ù† ${winner} Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯! ğŸ†`;
            updateLeaderboard('twoPlayer', `Ø¨Ø§Ø²ÛŒÚ©Ù† ${winner}`, 1);
        } else if(mode === "online") {
            if(winner === player.symbol) {
                resultText = `Ø´Ù…Ø§ ${opponent.name} Ø±Ø§ Ø´Ú©Ø³Øª Ø¯Ø§Ø¯ÛŒØ¯! ğŸ‰`;
                updateLeaderboard('online', player.name, 1);
            } else {
                resultText = `${opponent.name} Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!`;
            }
        }
    } else {
        resultText = "Ø¨Ø§Ø²ÛŒ Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯! ğŸ¤";
        if(mode === "online") {
            updateLeaderboard('online', player.name, 0.5);
            updateLeaderboard('online', opponent.name, 0.5);
        }
    }
    
    document.getElementById('result').textContent = resultText;
    showPage('gameOver');
}

// ====== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ ======
function updateLeaderboard(mode, playerName, score) {
    let leaderboard = leaderboards[mode];
    let existingPlayer = leaderboard.find(p => p.name === playerName);
    
    if(existingPlayer) {
        existingPlayer.score += score;
    } else {
        leaderboard.push({name: playerName, score: score});
    }
    
    leaderboard.sort((a, b) => b.score - a.score);
    localStorage.setItem(mode + 'Leaderboard', JSON.stringify(leaderboard));
}

function updateLeaderboardDisplay() {
    const singleLB = document.getElementById('singleLeaderboard');
    singleLB.innerHTML = leaderboards.single.slice(0, 5).map((player, index) => `
        <div class="leaderboard-item">
            <span class="player-name">${index + 1}. ${player.name}</span>
            <span class="player-score">${player.score} ğŸ†</span>
        </div>
    `).join('') || '<div style="text-align:center; color:#666;">Ù‡Ù†ÙˆØ² Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';

    const twoPlayerLB = document.getElementById('twoPlayerLeaderboard');
    twoPlayerLB.innerHTML = leaderboards.twoPlayer.slice(0, 5).map((player, index) => `
        <div class="leaderboard-item">
            <span class="player-name">${index + 1}. ${player.name}</span>
            <span class="player-score">${player.score} ğŸ†</span>
        </div>
    `).join('') || '<div style="text-align:center; color:#666;">Ù‡Ù†ÙˆØ² Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';

    const onlineLB = document.getElementById('onlineLeaderboard');
    onlineLB.innerHTML = leaderboards.online.slice(0, 5).map((player, index) => `
        <div class="leaderboard-item">
            <span class="player-name">${index + 1}. ${player.name}</span>
            <span class="player-score">${player.score} ğŸ†</span>
        </div>
    `).join('') || '<div style="text-align:center; color:#666;">Ù‡Ù†ÙˆØ² Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';
}

// ====== Ø¨Ø§Ø²ÛŒ ØªÚ© Ù†ÙØ±Ù‡ Ø¨Ø§ Ø±Ø¨Ø§Øª ======
function startSinglePlayer(){
    gameMode="single";
    player.symbol="X"; 
    myTurn=true;
    board=["","","","","","","","",""];
    showPage('game');
    updateBoard();
    document.getElementById('turnMsg').textContent = "Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª!";
}

// ====== Ø¨Ø§Ø²ÛŒ Ø¯Ùˆ Ù†ÙØ±Ù‡ ======
function startTwoPlayers(){
    gameMode="two";
    currentSymbol="X";
    board=["","","","","","","","",""];
    showPage('game');
    updateBoard();
    document.getElementById('turnMsg').textContent = `Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù† ${currentSymbol}`;
}

// ====== Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† ======
function startOnline(){
    showPage('onlineInfo');
}

function startOnlineDemo(){
    gameMode = "online";
    
    // Ø§Ù†ØªØ®Ø§Ø¨ ØªØµØ§Ø¯ÙÛŒ ÛŒÚ© Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø­Ø±ÛŒÙ
    const randomIndex = Math.floor(Math.random() * onlinePlayers.length);
    opponent.name = onlinePlayers[randomIndex];
    opponent.symbol = "O";
    player.symbol = "X";
    
    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
    showPage('waiting');
    
    setTimeout(() => {
        onlineBoard = ["","","","","","","","",""];
        myTurn = true;
        createOnlineBoard();
        updateOnlineBoard();
        document.getElementById('opponentName').textContent = opponent.name;
        document.getElementById('onlineTurnMsg').textContent = "Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª! (Ø´Ù…Ø§ X Ù‡Ø³ØªÛŒØ¯)";
        showPage('onlineGame');
    }, 2000);
}

function cancelOnline(){
    showPage('gameOptions');
}

// ====== Ø­Ø±Ú©Øª Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ) ======
function makeOpponentMove(){
    const empty = onlineBoard.map((v,i)=>v===""?i:-1).filter(v=>v!==-1);
    if(empty.length===0) return;
    
    // ØªØ£Ø®ÛŒØ± Ø·Ø¨ÛŒØ¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙÚ©Ø± Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†
    setTimeout(() => {
        const move = empty[Math.floor(Math.random() * empty.length)];
        onlineBoard[move] = opponent.symbol;
        updateOnlineBoard();
        
        const winner = checkWinner(onlineBoard);
        if(winner) {
            handleWinner(winner, "online");
        } else {
            myTurn = true;
            document.getElementById('onlineTurnMsg').textContent = "Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª!";
        }
    }, 1000 + Math.random() * 1000);
}

// ====== ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ ØªØ®ØªÙ‡ ======
function cellClick(i){
    if(board[i]!=="") return;
    
    if(gameMode==="single"){
        if(myTurn){ 
            board[i]=player.symbol; 
            myTurn=false; 
            updateBoard(); 
            document.getElementById('turnMsg').textContent = "Ù†ÙˆØ¨Øª Ø±Ø¨Ø§Øª";
            let winner = checkWinner(board); 
            if(!winner) setTimeout(robotMove,500); 
            else handleWinner(winner, "single");
        }
    } else if(gameMode==="two"){
        board[i]=currentSymbol; 
        updateBoard(); 
        let winner = checkWinner(board);
        if(winner) {
            handleWinner(winner, "two");
        } else {
            currentSymbol=currentSymbol==="X"?"O":"X";
            document.getElementById('turnMsg').textContent = `Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù† ${currentSymbol}`;
        }
    }
}

function onlineCellClick(i){
    if(gameMode !== "online" || !myTurn || onlineBoard[i]!=="") return;
    
    onlineBoard[i] = player.symbol;
    updateOnlineBoard();
    myTurn = false;
    document.getElementById('onlineTurnMsg').textContent = `Ù†ÙˆØ¨Øª ${opponent.name}...`;
    
    const winner = checkWinner(onlineBoard);
    if(winner) {
        handleWinner(winner, "online");
    } else {
        // Ø­Ø±ÛŒÙ Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        makeOpponentMove();
    }
}

// ====== Ø­Ø±Ú©Øª Ø±Ø¨Ø§Øª ======
function robotMove(){
    const empty = board.map((v,i)=>v===""?i:-1).filter(v=>v!==-1);
    if(empty.length===0) return;
    const move = empty[Math.floor(Math.random()*empty.length)];
    board[move] = "O";
    myTurn = true;
    updateBoard();
    document.getElementById('turnMsg').textContent = "Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª!";
    
    const winner = checkWinner(board);
    if(winner) handleWinner(winner, "single");
}

// ====== Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ======
window.onload = function() {
    const savedName = localStorage.getItem('playerName');
    if(savedName) {
        player.name = savedName;
        document.getElementById('playerName').value = savedName;
        showPage('mainMenu');
    } else {
        showPage('lobby');
    }
    
    createBoard();
    createOnlineBoard();
    updateLeaderboardDisplay();
    
    // ØªÙˆÙ„ÛŒØ¯ ID ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†
    player.id = 'player_' + Math.random().toString(36).substr(2, 9);
}
</script>
</body>
</html>